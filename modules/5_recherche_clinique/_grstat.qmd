---
format:
  revealjs:
    theme: simple
    css: assets/style.css
    pagetitle: "Oncostat R - recherche clinique"
    template-partials:
     - assets/title-slide.html
    title: "√âquipe ONCOSTAT <br> Modules de cours de R"
    subtitle: "Import et check de bases & tables standards"
    author: "Dan Chaltiel"
    description: "üì¶ {EDCimport} et üì¶ {grstat}"
    incremental: true
    controls: true
    keyboard: true
    code-line-numbers: true
    # embed-resources: true
    scrollable: true
    number-sections: true
    number-depth: 1
    slide-number: true
    smaller: true
    preview-links: auto
    footer: "Le code source de cette pr√©sentation est disponible [sur GitHub](https://github.com/Oncostat/rstat_training/){target='_blank'}."
execute:
  echo: true
  cache: true
  code-overflow: wrap
  warnings: false
  messages: false
keywords: ["r", "rstat", "training", "course", "module"]
mouse-wheel: true
knitr:
  opts_chunk: 
    collapse: true
    comment: "#>" 
    R.options:
      crosstable_compact: true
      width: 105
editor: 
  markdown: 
    wrap: 72
---

```{r}
#| include: false
library(tidyverse)
library(grstat)
```

## Le package `grstat` üì¶

-   Package interne au BBE
-   Reprend les macros SAS valid√©es
-   Propose des sorties standardis√©es

::: {.callout-note title="Version" fragment-index="4" real-fragment-index="4"}
Cette pr√©sentation a √©t√© r√©alis√©e avec `grstat` v`{r} packageVersion("grstat")`.
:::

## Documentation

Accessible dans RStudio et [en
ligne](https://oncostat.github.io/grstat/index.html):

<iframe src="https://oncostat.github.io/grstat/index.html" style="width:1000px; height:500px">

</iframe>


## Fonctions {.nonincremental}

Fonctions stables et valid√©es :

-   Tableaux AE : `ae_table_grade()` & `ae_table_soc()`
-   Graphiques AE : `ae_plot_grade()` & `butterfly_plot()` 

. . .

Fonctions en cours de d√©veloppement : 

-  Swimmerplot & Waterfall-plot RECIST
-  Forest-plot
-  Sorties standard pour les mod√®les principaux
-  Vignettes/Book de documentation

. . .

::: {.callout-tip .no_fragment title="Liste"}
La liste des fonctions est accessible dans [les r√©f√©rences de la doc](https://oncostat.github.io/grstat/reference/index.html).
:::


## Donn√©es d'exemple

On va utiliser une base de donn√©es d'exemple.

```{r}
#| attr-source: "style='max-height: 400px !important;'"
#| cache: false
library(grstat)
db = grstat_example(r=0.4)
attach(db, warn.conflicts=FALSE)

db
```

::: {.callout-note title="EDCimport" fragment-index="2" real-fragment-index="2"}
`db` n'est pas (encore) une base EDCimport mais fonctionne de la m√™me fa√ßon.
:::


## AE par grade : tableaux

::::: {.panel-tabset .no_fragment style="grid-template-columns: 16% 82%;"}

### Total

```{r}
#| classes: no_fragment
ae_table_grade(df_ae=ae, df_enrol=enrolres, arm=NULL) %>%
  as_flextable(header_show_n=TRUE)
```

### Par bras

```{r}
#| classes: no_fragment
ae_table_grade(df_ae=ae, df_enrol=enrolres, arm="arm") %>%
  as_flextable(header_show_n=TRUE)
```

### SAE

```{r}
#| classes: no_fragment
ae %>%
  filter(sae=="Yes") %>%
  ae_table_grade(df_enrol=enrolres, arm="arm", ae_label="SAE") %>%
  as_flextable(header_show_n=TRUE)
```

### Population

Pour d√©crire une sous-population, il faut filtrer `df_enrol`:

```{r}
#| classes: no_fragment
enrolres2 = enrolres %>%
  filter(arm=="Control")
ae %>%
  ae_table_grade(df_enrol=enrolres2, arm="arm") %>%
  as_flextable(header_show_n=TRUE)
```

### Postprod

On peut modifier le r√©sultat avant de passer en `flextable`:

```{r}
#| classes: no_fragment
ae %>%
  ae_table_grade(df_enrol=enrolres, arm="arm") %>%
  filter(!variable %in% c("Grade 1", "Grade 2")) %>%
  as_flextable(header_show_n=TRUE)
```

:::::


## AE par grade : graphiques

::::: {.panel-tabset .no_fragment style="grid-template-columns: 16% 82%;"}

### Total

```{r}
#| classes: no_fragment
#| fig-height: 3.7
ae_plot_grade(df_ae=ae, df_enrol=enrolres, arm=NULL) #340
```

### Par bras

```{r}
#| classes: no_fragment
#| fig-height: 3.7
ae_plot_grade(df_ae=ae, df_enrol=enrolres, arm="ARM", 
              variant=c("max", "sup")) #453
```

### Absolues

‚ö† Attention aux valeurs absolues pour des essais non √©quilibr√©s !

```{r}
#| classes: no_fragment
#| fig-height: 3.7
ae_plot_grade(df_ae=ae, df_enrol=enrolres, arm="ARM", 
              type="absolute") #567
```


:::::


## AE par SOC : tableaux

::::: {.panel-tabset .no_fragment style="grid-template-columns: 16% 82%;"}

### Total

```{r}
#| classes: no_fragment
ae_table_soc(df_ae=ae, df_enrol=enrolres, arm=NULL) %>%
  as_flextable()
```

### Par bras

```{r}
#| classes: no_fragment
ae_table_soc(df_ae=ae, df_enrol=enrolres, arm="arm") %>%
  as_flextable()
```


### Population

Idem, pour d√©crire une sous-population, il faut filtrer `df_enrol`:

```{r}
#| classes: no_fragment
enrolres2 = enrolres %>% head(50)
ae %>%
  ae_table_soc(df_enrol=enrolres2, arm="arm") %>%
  as_flextable()
```

### Avec Term

```{r}
#| classes: no_fragment
ae_table_soc(df_ae=ae, df_enrol=enrolres, arm="ARM", 
             term="aeterm") %>%
  as_flextable()
```

:::::

## AE par SOC : graphiques

::::: {.panel-tabset .no_fragment style="grid-template-columns: 16% 82%;"}

### Butterfly

```{r}
#| classes: no_fragment
#| fig-height: 3.7
butterfly_plot(df_ae=ae, df_enrol=enrolres)
```

### Serious

```{r}
#| classes: no_fragment
#| fig-height: 3.7
ae %>% 
  mutate(serious = sae=="Yes") %>% #colonne logical/booleanZ
  butterfly_plot(df_enrol=enrolres, severe="serious") +
  labs(caption="Darker areas represent Serious Adverse Events")
```

:::::

<script src="assets/custom.js"></script>
